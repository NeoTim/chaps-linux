From e26edf4f15e7b05af23a9a7d4328f9347e10a3f8 Mon Sep 17 00:00:00 2001
From: David Drysdale <drysdale@google.com>
Date: Thu, 2 Oct 2014 12:03:15 +0100
Subject: [PATCH 5/9] chaps: Protect against bad argument to C_GetInfo

BUG=None
TEST=Chaps unit tests plus PKCS11 tests
---
 chaps/chaps.cc | 1 +
 1 file changed, 1 insertion(+)

diff --git a/chaps/chaps.cc b/chaps/chaps.cc
index 077323d..c94e03c 100644
--- a/chaps/chaps.cc
+++ b/chaps/chaps.cc
@@ -183,6 +183,7 @@ CK_RV C_GetInfo(CK_INFO_PTR pInfo) {
 
 // PKCS #11 v2.20 section 11.4 page 106.
 CK_RV C_GetFunctionList(CK_FUNCTION_LIST_PTR_PTR ppFunctionList) {
+  LOG_CK_RV_AND_RETURN_IF(!ppFunctionList, CKR_ARGUMENTS_BAD);
   static CK_VERSION version = {2, 20};
   static CK_FUNCTION_LIST functionList = {
     version,
-- 
1.9.1

